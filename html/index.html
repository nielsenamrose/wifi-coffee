<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Wi-Fi coffee</title>
    <link rel="icon" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    <link rel="stylesheet" href="stylesheet.css" type="text/css">
  </head>
  <body>
    <img id="background" src="background.jpg"></img>
    <div id="circle"></div>    
    <script>
      const img = document.querySelector("#background");
      const circle = document.querySelector("#circle");
      
      const updateCircle = function () {
        var ratio = img.naturalWidth / img.naturalHeight;
        var width = img.height * ratio;
        if (width > img.width) {
          width = img.width;
        }
        let r = width*0.245;
        let b = width*0.0564;
        console.log(`width=${width} r=${r}`);
        circle.style.width = `${2 * r}px`;
        circle.style.height = `${2 * r}px`;
        circle.style.transform = `translate(${img.width / 2 - r - b}px, ${img.height / 2 - r - b}px)`;
        circle.style["border-width"] = `${b}px`;
      };
      window.addEventListener("resize", updateCircle);
      window.addEventListener("load", updateCircle);

      var valueAge = 0;
      
      const handleData = function(data) {
        console.log(data);
        ledInChangeTime = data.timestamp;
        if (valueAge >= 10000)
          circle.classList.toggle("on", data.value);
      }

      setInterval(() => {
        fetch("http://192.168.1.15:8081/api/read")
          .then((response) => response.json())
          .then(handleData);
        if (valueAge > 10000) circle.classList.toggle("on");
      }, 500);
      
      circle.addEventListener("click", () => {
        fetch("http://192.168.1.15:8081/api/push");
        circle.classList.toggle("on");
      });
    </script>
  </body>
</html>